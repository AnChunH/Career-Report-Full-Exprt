<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>🎯 生涯規劃報告 I+II（完整版）</title>
  <style>
    body { font-family: 'Microsoft JhengHei', sans-serif; padding: 30px; background: #f4f6f8; }
    h1, h2 { color: #2c3e50; }
    label { display: block; margin-top: 15px; font-weight: bold; }
    input[type=text], textarea, select {
      width: 100%; padding: 10px; margin-top: 5px; border-radius: 5px; border: 1px solid #ccc;
    }
    textarea { min-height: 80px; }
    .section {
      background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 30px;
    }
    button {
      background-color: #27ae60; color: white; padding: 10px 20px; border: none;
      border-radius: 5px; cursor: pointer; font-size: 16px; margin-right: 10px;
    }
    button:hover { background-color: #1e8449; }
    .group-description, .group-links { font-size: 14px; color: #444; margin-top: 5px; }
  </style>
</head>
<body>
  <h1>🎯 生涯規劃報告 I+II（完整版）</h1>

  <div class="section">
    <label>📘 班級：</label><input type="text" id="studentClass" required>
    <label>📌 姓名：</label><input type="text" id="studentName" required>
    <label>📅 日期：</label><input type="text" id="reportDate" placeholder="例如：2025/06/01" required>
  </div>

  <div class="section">
    <h2>🧠 第一部分：學習歷程回顧</h2>
    <label>你曾為什麼目標努力？</label><textarea required></textarea>
    <label>你最有成就感的一件事（學習）是什麼？</label><textarea required></textarea>
    <label>你覺得自己比較適合哪種學習方式？理論 / 實作 / 創作？</label><textarea required></textarea>
    <label>哪個經驗讓你覺得自己適合某個領域？</label><textarea required></textarea>
  </div>

  <div class="section">
    <h2>📘 第二部分：學習歷程盤點（九大項）</h2>
    <div id="dynamicFields"></div>
  </div>

  <div class="section">
    <h2>🎯 第三部分：高二發展計畫</h2>
    <label>我需要加強的部分：</label><textarea required></textarea>
    <label>新增的自主學習與活動計畫：</label><textarea required></textarea>
    <label>預計參與的課外活動與計畫：</label><textarea required></textarea>
    <label>希望高二能達成的目標：</label><textarea required></textarea>
  </div>

  <div class="section">
    <h2>🎓 第四部分：升學方向規劃</h2>
    <label>興趣學群：</label><textarea required></textarea>
    <label>可能選擇的科系：</label><textarea required></textarea>
    <label>所需補強之學習歷程項目：</label><textarea required></textarea>
  </div>

  <div class="section">
    <h2>✍ 結語反思</h2>
    <label>你從這次回顧中得到的體悟：</label><textarea required></textarea>
    <label>你希望接下來的學習狀態與努力方向是：</label><textarea required></textarea>
  </div>

  <div class="section">
    <h2>🤖 AI 推薦學群（依填寫內容自動預測）</h2>
    <div id="ai-suggestion">（請先填寫上方內容，本區將自動產生建議學群）</div>
  </div>

  <button onclick="downloadReport()">💾 下載填寫結果 (.txt)</button>

  <script>
    const fieldTitles = [
      "學科學習", "跨領域學習", "學科競賽", "自主學習", "科學講座與論壇",
      "志工與社會服務", "社團與領導活動", "作品與專題報告", "未來學習目標"
    ];

    const studyGroups = [
      ["數理化學學群", "著重數學與自然科學原理，包含數學系、化學系、物理系等"],
      ["工程學群", "強調工程實作與應用，包含機械、電機、土木、生醫工程等"],
      ["資訊學群", "探討電腦科學與資料處理，包含資工、資管、AI 等"],
      ["生物資源學群", "聚焦動植物、農業與環境，包含農藝、生技、森林等"],
      ["生命科學學群", "研究生命現象，包含生科、生醫、生化、基因體等"],
      ["醫藥衛生學群", "涵蓋醫學、藥學、護理、公衛等健康領域"],
      ["地球與環境學群", "探討地球系統與永續發展，包含地科、環工、海洋等"],
      ["設計學群", "強調創意與實作，包含工設、視傳、建築、時尚等"],
      ["藝術學群", "藝術創作與表演相關，包含美術、音樂、戲劇、舞蹈等"],
      ["社會與心理學群", "研究人類行為與社會系統，包含社會、心理、人類學等"],
      ["人文社會學群", "探討歷史、哲學與語文，包含中文、外文、歷史、哲學等"],
      ["法政學群", "涉及法律與政治制度，包含法律、政治、外交等"],
      ["財經管理學群", "經濟運作與企業經營，包含會計、財金、企管、行銷等"],
      ["教育學群", "教學與師資養成相關，包含教育、幼教、特教等"],
      ["其他學群", "不屬上述分類，如體育、軍警、語言等"]
    ];

    const dyn = document.getElementById("dynamicFields");
    fieldTitles.forEach(title => {
      const options = studyGroups.map(([label, desc]) => `<option value="${label}" title="${desc}">${label}</option>`).join("");
      dyn.innerHTML += `
        <div class="sub">
          <h3>🔹 ${title}</h3>
          <label>目前成果：</label><textarea required></textarea>
          <label>學習歷程紀錄：</label><textarea required></textarea>
          <label>補強計畫：</label><textarea required></textarea>
          <label>對應學群：（可多選，請按住 Ctrl 或 ⌘ 鍵）</label>
          <select required multiple size="5" onchange="showGroupTooltip(this)">${options}</select>
          <div class="group-description"></div>
          <div class="group-links"></div>
        </div>
      `;
    });

    function showGroupTooltip(select) {
      const descDiv = select.nextElementSibling;
      const linkDiv = descDiv.nextElementSibling;
      const selected = Array.from(select.selectedOptions);
      const tips = selected.map(option => `• ${option.value}: ${option.title}`);
      const links = selected.map(option => `🔗 <a href='https://collego.edu.tw/CollegeGroup/${option.value}' target='_blank'>${option.value} 相關科系</a>`);
      descDiv.innerHTML = tips.length ? tips.join('<br>') : '(尚未選擇學群)';
      linkDiv.innerHTML = links.length ? links.join('<br>') : '';
    }

    document.querySelectorAll('select[multiple]').forEach(select => {
      const notice = document.createElement('div');
      notice.style.color = 'gray';
      notice.style.fontSize = '14px';
      notice.textContent = '（已選擇 0 / 最多 3 個）';
      select.after(notice);
      select.addEventListener('change', () => {
        const count = Array.from(select.selectedOptions).length;
        notice.textContent = `（已選擇 ${count} / 最多 3 個）`;
        if (count > 3) {
          alert('最多只能選擇 3 個學群！');
        }
      });
    });

    function downloadReport() {
      const fields = document.querySelectorAll("textarea, input[type=text], select");
      let content = "🎯 生涯規劃報告 I+II 填寫內容如下：\n\n";
      const studentClass = document.getElementById("studentClass").value.trim();
      const studentName = document.getElementById("studentName").value.trim();
      const reportDate = document.getElementById("reportDate").value.trim();
      content += `📘 班級：${studentClass}\n📌 姓名：${studentName}\n📅 日期：${reportDate}\n\n`;

      fields.forEach((el, i) => {
        if (["studentName", "studentClass", "reportDate"].includes(el.id)) return;
        const label = el.previousElementSibling?.innerText?.trim() || `欄位 ${i + 1}`;
        let value = "";
        if (el.tagName === "SELECT" && el.multiple) {
          value = Array.from(el.selectedOptions).map(opt => opt.value).join(", ");
        } else {
          value = el.value.trim();
        }
        content += `【${label}】\n${value}\n\n`;
      });

      const blob = new Blob([content], { type: "text/plain;charset=utf-8" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = `生涯規劃報告_${studentName || "未命名"}.txt`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function extractTextInputs() {
      return Array.from(document.querySelectorAll("textarea")).map(a => a.value.toLowerCase()).join(" ");
    }
    function suggestGroups(text) {
      const keywords = {
        "資訊": "資訊學群",
        "程式": "資訊學群",
        "數學": "數理化學學群",
        "實驗": "生命科學學群",
        "生物": "生命科學學群",
        "醫": "醫藥衛生學群",
        "環境": "地球與環境學群",
        "創作": "藝術學群",
        "繪圖": "設計學群",
        "心理": "社會與心理學群",
        "教學": "教育學群",
        "經濟": "財經管理學群",
        "法律": "法政學群"
      };
      const result = new Set();
      for (const [k, group] of Object.entries(keywords)) {
        if (text.includes(k)) result.add(group);
      }
      return [...result];
    }
    function updateSuggestion() {
      const raw = extractTextInputs();
      const matched = suggestGroups(raw);
      const container = document.getElementById("ai-suggestion");
      if (matched.length === 0) {
        container.innerHTML = "（尚未找到明確的推薦，請填寫更多內容）";
      } else {
        container.innerHTML = "🔍 根據你的填寫，以下學群可能與你相符：<ul>" +
          matched.map(g => `<li>${g} <a href='https://collego.edu.tw/CollegeGroup/${encodeURIComponent(g)}' target='_blank'>ColleGo! 連結</a></li>`).join("") +
          "</ul>";
      }
    }
    document.querySelectorAll("textarea").forEach(el => {
      el.addEventListener("input", () => setTimeout(updateSuggestion, 300));
    });
  </script>
</body>
</html>
